var t = require("../../../@babel/runtime/helpers/slicedToArray");

require("../../../@babel/runtime/helpers/Arrayincludes");

var e = require("../../../@babel/runtime/helpers/defineProperty"), n = require("../../../@babel/runtime/helpers/classCallCheck"), r = require("../../../@babel/runtime/helpers/createClass"), o = require("../../../@babel/runtime/helpers/typeof");

!function(t, e) {
    "object" == ("undefined" == typeof exports ? "undefined" : o(exports)) && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define(e) : (t = t || self).anim = e();
}(void 0, function() {
    var a = [ "onLoad", "onShow", "onReady", "onHide", "onUnload", "onPullDownRefresh", "onReachBottom", "onPageScroll", "onResize" ], i = [ "data", "computed", "watch" ];
    function c(t) {
        var e;
        return e = t.reduce(function(t, e) {
            return Object.keys(e).forEach(function(n) {
                if (a.includes(n)) return t[n].push(e[n]);
                i.includes(n) ? t[n] = Object.assign({}, t[n], e[n]) : t[n] = e[n];
            }), t;
        }, function() {
            var t = a.reduce(function(t, e) {
                return t[e] = [], t;
            }, {});
            return Object.assign({
                mixins: [],
                data: {}
            }, t);
        }()), a.reduce(function(t, e) {
            return t[e] && t[e].length > 0 ? (t["__anim_".concat(e)] = t[e].slice(), t[e] = function() {
                for (var n = this, r = arguments.length, o = new Array(r), a = 0; a < r; a++) o[a] = arguments[a];
                t["__anim_".concat(e)].forEach(function(t) {
                    t.apply(n, o);
                });
            }) : delete t[e], t;
        }, e);
    }
    var u = 0, s = function() {
        function t() {
            n(this, t), this.subs = [], this.id = ++u;
        }
        return r(t, [ {
            key: "addSub",
            value: function(t) {
                this.subs.push(t);
            }
        }, {
            key: "depend",
            value: function() {
                t.target && t.target.addDep(this);
            }
        }, {
            key: "notify",
            value: function() {
                this.subs.forEach(function(t) {
                    setTimeout(function() {
                        return t.update();
                    });
                });
            }
        } ]), t;
    }(), f = 0, l = function() {
        function t(e, r, o) {
            n(this, t), this.id = ++f, this.depIdMap = {}, this.dep = new s(), this.vm = e, 
            this.fn = r, this.cb = o, this.value = this.getValue(), this.oldValue = void 0;
        }
        return r(t, [ {
            key: "getValue",
            value: function() {
                s.target = this;
                var t = this.fn.call(this.vm);
                return s.target = void 0, t;
            }
        }, {
            key: "update",
            value: function() {
                this.oldValue = this.value, this.value = this.getValue(), this.cb.call(this.vm);
            }
        }, {
            key: "addDep",
            value: function(t) {
                this.depIdMap.hasOwnProperty(t.id) || (t.addSub(this), this.depIdMap[t.id] = t);
            }
        }, {
            key: "depend",
            value: function() {
                this.dep.depend();
            }
        } ]), t;
    }();
    function d(t, e, n, r) {
        var o, a = !1, i = 0;
        function c() {
            o && clearTimeout(o);
        }
        function u() {
            var u = this, s = Date.now() - i, f = arguments;
            function l() {
                i = Date.now(), n.apply(u, f);
            }
            a || (r && !o && l(), c(), void 0 === r && s > t ? l() : !0 !== e && (o = setTimeout(r ? function() {
                o = void 0;
            } : l, void 0 === r ? t - s : t)));
        }
        return "boolean" != typeof e && (r = n, n = e, e = void 0), u.cancel = function() {
            c(), a = !0;
        }, u;
    }
    function h(t, e, n) {
        return void 0 === n ? d(t, e, !1) : d(t, n, !1 !== e);
    }
    function p(t) {
        return String.prototype.split.call(t, /[,[\].]+?/).filter(Boolean);
    }
    function y(t) {
        if (t.watch) {
            var e = {};
            Object.keys(t.watch).forEach(function(n) {
                var r = t.watch[n];
                if ("function" == typeof r) {
                    var o = p(n).slice(0, -1), a = p(n).slice(-1)[0] || n;
                    e[n] = function(t, e) {
                        var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                        return p(e).reduce(function(t, e) {
                            return Object.hasOwnProperty.call(t, e) ? t[e] : n;
                        }, t);
                    }(t.data, n);
                    var i = t.data;
                    o.forEach(function(t) {
                        i = i[t];
                    });
                    var c = Object.getOwnPropertyDescriptor(i, a);
                    c && Object.defineProperty(i, a, {
                        configurable: c.configurable,
                        enumerable: c.enumerable,
                        get: function() {
                            return c && c.get ? c.get() : e[n];
                        },
                        set: h(10, function(o) {
                            var a = e[n];
                            r.call(t, o, a), c && c.set && c.set(o), e[n] = o;
                        })
                    });
                }
            });
        }
    }
    var v = {
        onLoad: function() {
            var t;
            "object" == o((t = this).data) && "null" !== t.data && Object.keys(t.data).forEach(function(e) {
                var n = Object.assign({}, t.data)[e], r = new s();
                Object.defineProperty(t.data, e, {
                    set: function(t) {
                        t === n || t != t && n != n || (n = t, r.notify());
                    },
                    get: function() {
                        return r.depend(), n;
                    }
                });
            }), function(t) {
                wx.nextTick ? wx.nextTick(function() {
                    return y(t);
                }) : setTimeout(function() {
                    return y(t);
                });
            }(this), function(t) {
                if (t.computed) {
                    var n = {};
                    Object.keys(t.computed).forEach(function(r) {
                        var o = t.computed[r];
                        if ("function" == typeof o) {
                            var a = new l(t, o, function() {
                                t.setData && t.setData(e({}, r, a.value));
                            });
                            t.data[r] = a.value, n[r] = a.value, Object.defineProperty(t.data, r, {
                                configurable: !0,
                                enumerable: !0,
                                set: function(t) {
                                    return t;
                                },
                                get: function() {
                                    return a.depend(), a.value;
                                }
                            });
                        }
                    }), t.setData && t.setData(n);
                }
            }(this);
        }
    }, b = Object.keys(wx).filter(function(t) {
        return t.endsWith("Sync");
    }).map(function(t) {
        return t.replace(/Sync$/, "");
    }).concat([ "navigateTo", "navigateBack", "redirectTo", "reLaunch" ]).concat([ "request", "downloadFile", "uploadFile" ]).reduce(function(t, e) {
        return t[e] = function(t) {
            return function(e) {
                return new Promise(function(n, r) {
                    t(Object.assign({}, e, {
                        success: function(t) {
                            e.success && e.success(t), n(t);
                        },
                        fail: function(t) {
                            e.fail && e.fail(t), r(t);
                        }
                    }));
                });
            };
        }(wx[e]), t;
    }, {}), _ = Object.assign({}, wx, b), g = [];
    function m() {
        var t, e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}, n = getCurrentPages().slice(-1)[0];
        t = e.__anim__query ? JSON.parse(decodeURIComponent(e.__anim__query)) : {};
        var r, o = {
            path: n.route,
            query: t
        };
        this.$route = o, this.setData && this.setData({
            $route: o
        }), (r = this).$router = {
            navigateTo: function(t) {
                return t.__anim_route_type = "navigateTo", g.length < 10 ? _.navigateTo({
                    url: j(t)
                }) : r.$router.redirectTo(t);
            },
            navigateBack: function() {
                var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1;
                return _.navigateBack({
                    delta: t
                });
            },
            redirectTo: function(t) {
                return t.__anim_route_type = "redirectTo", _.redirectTo({
                    url: j(t)
                });
            },
            reLaunch: function(t) {
                return t.__anim_route_type = "reLaunch", _.reLaunch({
                    url: j(t)
                });
            },
            switchTab: function(t) {
                return t.__anim_route_type = "switchTab", _.switchTab({
                    url: j(t)
                });
            },
            go: function(t) {
                if (t < 0) return _.navigateBack({
                    delta: Math.abs(t)
                });
            }
        }, "reLaunch" === t.__anim_route_type ? g = [ o ] : g.push(o), this.$routes = g;
    }
    function j(t) {
        var e = encodeURIComponent(JSON.stringify(Object.assign({}, t.query, {
            __anim_route_type: t.__anim_route_type
        })));
        return "".concat(t.path, "?__anim__query=").concat(e);
    }
    var O, w = {
        onLoad: function(t) {
            m.call(this, t);
        },
        onUnload: function() {
            (function() {
                g.pop();
            }).call(this);
        }
    }, k = {}, x = [], S = function t(e, n) {
        if (Object.prototype.toString.call(e) !== Object.prototype.toString.call(n)) return !1;
        if (Object.keys(e).length !== Object.keys(n).length) return !1;
        var r = !0;
        return Object.keys(e).forEach(function(o) {
            switch (Object.prototype.toString.call(e[o])) {
              case "[object Object]":
                t(e[o], n[o]) || (r = !1);
                break;

              case "[object Array]":
                T(e[o], n[o]) || (r = !1);
                break;

              default:
                e[o] !== n[o] && (r = !1);
            }
        }), r;
    }, T = function(t, e) {
        if (Object.prototype.toString.call(t) !== Object.prototype.toString.call(e)) return !1;
        if (t.length !== e.length) return !1;
        var n = !0;
        return t.forEach(function(t, r) {
            t !== e[r] && (n = !1);
        }), n;
    }, P = function t(e, n) {
        var r = {};
        return Object.keys(e).forEach(function(o) {
            if (!n || n.includes(o)) switch (Object.prototype.toString.call(e[o])) {
              case "[object Object]":
                r[o] = t(e[o]);
                break;

              case "[object Array]":
                r[o] = D(e[o]);
                break;

              default:
                r[o] = e[o];
            }
        }), r;
    }, D = function t(e) {
        return e.map(function(e) {
            switch (Object.prototype.toString.call(e)) {
              case "[object Object]":
                return P(e);

              case "[object Array]":
                return t(e);

              default:
                return e;
            }
        });
    }, E = function(t) {
        var e = Object.prototype.toString.call(t);
        return "[object Object]" === e || "[object Array]" === e;
    }, q = 0;
    wx.getSystemInfoSync().system;
    try {
        O = Proxy;
    } catch (a) {
        O = function(t, e) {
            var n = Object.create(t.constructor.prototype, {
                __proxyhandler__: {
                    value: e
                }
            });
            return Object.keys(t).forEach(function(e) {
                Object.defineProperty(n, e, {
                    enumerable: !0,
                    get: function() {
                        return this.__proxyhandler__.get(t, e);
                    },
                    set: function(n) {
                        return this.__proxyhandler__.set(t, e, n);
                    }
                });
            }), n;
        };
    }
    var A = O, L = function(t) {
        return t.reduce(function(t, e) {
            return t && t[e] || void 0;
        }, k);
    }, R = function(t, e) {
        var n = t.length, r = t[n - 1], o = k;
        t.forEach(function(t, e) {
            e !== n - 1 && (o = o[t]);
        }), o[r] = e;
    }, C = function(t) {
        return function(e) {
            var n = e.onLoad, r = e.onUnload;
            return e.onLoad = function() {
                var e = t(k);
                x.push([ this, t, P(e) ]), this.setData(e), n && n.apply(this, arguments);
            }, e.onUnload = function() {
                x.pop(), r && r.call(this);
            }, e;
        };
    }, B = Object.freeze({
        mapToData: C,
        observe: function(e, n) {
            n = n || e.constructor.name.toLowerCase();
            var r = Object.getOwnPropertyNames(e);
            return e.__storeName__ = n, k[n] || (k[n] = P(e, r)), function e(n, r) {
                return Object.keys(n).forEach(function(t) {
                    E(n[t]) && (n[t] = e(n[t], r.concat([ t ])));
                }), new A(n, {
                    get: function(t, e) {
                        if ("__isProxy" === e) return !0;
                        if ("__data" === e) return L(r);
                        var n = L(r.concat([ e ]));
                        return void 0 !== n ? n : Reflect.get(t, e);
                    },
                    set: function(n, o, a) {
                        var i = a.__isProxy && a.__data || a, c = E(i) && e(P(i), r.concat([ o ])) || i, u = Reflect.set(n, o, c);
                        return R(r.concat([ o ]), i), q++, setTimeout(function() {
                            if (0 == --q) for (var e = x.length - 1; e >= 0; e--) {
                                var n = t(x[e], 3), r = n[0], o = n[1], a = n[2], i = o(k);
                                S(a, i) || (x[e][2] = P(i), r.setData(i));
                            }
                        }, 5), u;
                    }
                });
            }(e, [ n ]);
        }
    }), I = [ v, w ];
    function U(t) {
        var e = I.slice();
        Array.isArray(t.mixins) && (e = e.concat(t.mixins));
        var n = c(e.concat(t));
        if (n.store && "function" == typeof n.store) {
            var r = C(n.store);
            return Page(r(n));
        }
        return Page(n);
    }
    return U.mixin = function(t) {
        I = I.concat(t);
    }, {
        App: function(t) {
            function e(e) {
                return t.apply(this, arguments);
            }
            return e.toString = function() {
                return t.toString();
            }, e;
        }(function(t) {
            return App(t);
        }),
        Page: U,
        wedux: B,
        wechat: _
    };
});