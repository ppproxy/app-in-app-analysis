var e = require("../@babel/runtime/helpers/typeof");

!function(t, n) {
    "object" == ("undefined" == typeof exports ? "undefined" : e(exports)) && "undefined" != typeof module ? module.exports = n() : "function" == typeof define && define.amd ? define(n) : (t = "undefined" != typeof globalThis ? globalThis : t || self).Aegis = n();
}(void 0, function() {
    var t = function(e, n) {
        return (t = Object.setPrototypeOf || {
            __proto__: []
        } instanceof Array && function(e, t) {
            e.__proto__ = t;
        } || function(e, t) {
            for (var n in t) Object.prototype.hasOwnProperty.call(t, n) && (e[n] = t[n]);
        })(e, n);
    };
    function n(e, n) {
        function i() {
            this.constructor = e;
        }
        t(e, n), e.prototype = null === n ? Object.create(n) : (i.prototype = n.prototype, 
        new i());
    }
    var i = function() {
        return (i = Object.assign || function(e) {
            for (var t, n = 1, i = arguments.length; n < i; n++) for (var o in t = arguments[n]) Object.prototype.hasOwnProperty.call(t, o) && (e[o] = t[o]);
            return e;
        }).apply(this, arguments);
    };
    Object.assign || Object.defineProperty(Object, "assign", {
        enumerable: !1,
        configurable: !0,
        writable: !0,
        value: function(e) {
            if (null == e) throw new TypeError("Cannot convert first argument to object");
            for (var t = Object(e), n = 1; n < arguments.length; n++) if (null != (i = arguments[n])) for (var i = Object(i), o = Object.keys(Object(i)), r = 0, s = o.length; r < s; r++) {
                var a = o[r], u = Object.getOwnPropertyDescriptor(i, a);
                null != u && u.enumerable && (t[a] = i[a]);
            }
            return t;
        }
    });
    var o = (s.prototype.indexOf = function(e, t) {
        for (var n = 0; n < e.length; n++) if (e[n].callback === t) return n;
        return -1;
    }, s.prototype.on = function(e, t, n) {
        if (void 0 === n && (n = 0), this) {
            var i = this.eventsList[e];
            return i || (this.eventsList[e] = [], i = this.eventsList[e]), -1 !== this.indexOf(i, t) || i.push({
                name: e,
                type: n || 0,
                callback: t
            }), this;
        }
    }, s.prototype.one = function(e, t) {
        this.on(e, t, 1);
    }, s.prototype.remove = function(e, t) {
        if (this) {
            var n = this.eventsList[e];
            if (!n) return null;
            if (t) return n.length && (t = this.indexOf(n, t), n.splice(t, 1)), this;
            try {
                delete this.eventsList[e];
            } catch (e) {}
            return null;
        }
    }, s.prototype.clear = function() {
        this.eventsList = {};
    }, s), r = function(e) {
        try {
            return encodeURIComponent(decodeURIComponent(e));
        } catch (t) {
            return e;
        }
    };
    function s() {
        var e = this;
        this.emit = function(t, n) {
            if (e) {
                var i;
                if (null != (o = e.eventsList[t]) && o.length) for (var o = o.slice(), r = 0; r < o.length; r++) {
                    i = o[r];
                    try {
                        var s = i.callback.apply(e, [ n ]);
                        if (1 === i.type && e.remove(t, i.callback), !1 === s) break;
                    } catch (t) {
                        throw t;
                    }
                }
                return e;
            }
        }, this.eventsList = {};
    }
    function a(e, t) {
        return "string" == typeof e ? e.split("?")[t ? 1 : 0] || "" : e;
    }
    function u(e) {
        return "string" == typeof e && e.startsWith("//") ? "undefined" != typeof location && "https:" === location.protocol : /^https/.test(e);
    }
    function c(e, t) {
        var n;
        try {
            "string" == typeof e && (e = JSON.parse(e)), "function" == typeof (null === (n = null == t ? void 0 : t.ret) || void 0 === n ? void 0 : n.join) && (m = [].concat(t.ret.map(function(e) {
                return e.toLowerCase();
            })));
            var i = Object.getOwnPropertyNames(e).filter(function(e) {
                return -1 !== m.indexOf(e.toLowerCase());
            });
            return i.length ? "" + e[i[0]] : "unknown";
        } catch (e) {
            return "unknown";
        }
    }
    function l(e, t) {
        var n = (n = null === (n = e.api) || void 0 === n ? void 0 : n.errCode) && [].concat(n);
        e = (e = null === (e = e.api) || void 0 === e ? void 0 : e.code) && [].concat(e);
        return n && -1 !== n.indexOf(t) || e && -1 === e.indexOf(t) || !n && !e && "0" !== t && "unknown" !== t;
    }
    function f(t) {
        if ("string" == typeof t) return t;
        try {
            return (JSON.stringify(t, (n = [], i = [], function(t, o) {
                if (o instanceof Error) return "Error.message: " + o.message + " \n  Error.stack: " + o.stack;
                if ("object" == e(o) && null !== o) {
                    var r = n.indexOf(o);
                    if (-1 !== r) return "[Circular " + i[r] + "]";
                    n.push(o), i.push(t || "root");
                }
                return o;
            }), 4) || "undefined").replace(/"/gim, "");
        } catch (t) {
            return "error happen when aegis stringify: \n " + t.message + " \n " + t.stack;
        }
        var n, i;
    }
    (W = {})[W.number = -1] = "number", W.string = "";
    var p, d, h, g, m = [ "ret", "retcode", "code", "errcode" ], v = function(t, n) {
        var i = e(n), o = "";
        return "string" == i || "object" == i ? o += '"' + t + '":"' + n + '"' : "function" == typeof n ? o += '"' + t + '":"function ' + n.name + '"' : "symbol" == e(n) ? o += '"' + t + '":"symbol"' : "number" != typeof n && "boolean" != i || (o += '"' + t + '": ' + n), 
        o;
    }, y = function(t) {
        var n = e(t);
        return "" + ("undefined" == n || "symbol" == n || "function" == n ? "null" : "string" == n || "object" == n ? '"' + t + '"' : t);
    }, b = function(e, t) {
        var n, o = {
            fetch: [],
            static: []
        }, r = {};
        return Array.isArray(e) ? e.forEach(function(e) {
            var t;
            null === (t = o[e.type]) || void 0 === t || t.push(e);
        }) : null === (n = o[e.type]) || void 0 === n || n.push(e), r.payload = JSON.stringify(i({
            duration: o
        }, t)), r;
    };
    function w(e) {
        return e.filter(function(t, n) {
            return "static" !== t.type || !e.find(function(e, i) {
                return n !== i && t.url === e.url && 200 === t.status;
            });
        });
    }
    function O(e) {
        e.level === p.INFO_ALL && (e.level = p.INFO);
    }
    function R() {}
    function P(e, t) {
        Object.getOwnPropertyNames(e).forEach(function(n) {
            "function" == typeof e[n] && "constructor" !== n && (t ? t[n] = function() {} : e[n] = function() {});
        });
    }
    function E() {
        try {
            var e = getCurrentPages();
            return (e[e.length - 1] || {}).route || "";
        } catch (e) {
            return "";
        }
    }
    function x(e) {
        return new Y(e);
    }
    (K = p = p || {}).INFO_ALL = "-1", K.API_RESPONSE = "1", K.INFO = "2", K.ERROR = "4", 
    K.PROMISE_ERROR = "8", K.AJAX_ERROR = "16", K.SCRIPT_ERROR = "32", K.IMAGE_ERROR = "64", 
    K.CSS_ERROR = "128", K.CONSOLE_ERROR = "256", K.MEDIA_ERROR = "512", K.RET_ERROR = "1024", 
    K.REPORT = "2048", K.PV = "4096", K.EVENT = "8192", (G = d = d || {})[G.android = 1] = "android", 
    G[G.ios = 2] = "ios", G[G.windows = 3] = "windows", G[G.macos = 4] = "macos", G[G.linux = 5] = "linux", 
    G[G.devtools = 6] = "devtools", G[G.other = 100] = "other", (Q = h = h || {})[Q.unknown = 100] = "unknown", 
    Q[Q.wifi = 1] = "wifi", Q[Q.net2g = 2] = "net2g", Q[Q.net3g = 3] = "net3g", Q[Q.net4g = 4] = "net4g", 
    Q[Q.net5g = 5] = "net5g", Q[Q.net6g = 6] = "net6g", (ne = g = g || {}).LOG = "log", 
    ne.SPEED = "speed", ne.PERFORMANCE = "performance", ne.OFFLINE = "offline", ne.WHITE_LIST = "whiteList", 
    ne.VITALS = "vitals", ne.PV = "pv", ne.CUSTOM_PV = "customPV", ne.EVENT = "event", 
    ne.CUSTOM = "custom", ne.SDK_ERROR = "sdkError";
    var S, T, L, C = function(e, t) {
        return function(n, i) {
            var o = t.logCreated;
            return "function" != typeof o ? (e("beforeWrite", n), i(n)) : (n = n.filter(function(e) {
                return !1 !== o(e);
            }), e("beforeWrite", n), i(n));
        };
    }, k = function(e, t) {
        var n, i = [], o = e.config;
        return e.lifeCycle.on("destroy", function() {
            i.length = 0;
        }), function(e, r) {
            if (i.push(e), t && i.length >= t) return i = w(i), r(i.splice(0, i.length)), void (n && clearTimeout(n));
            n && clearTimeout(n), n = setTimeout(function() {
                n = null, 0 < (i = w(i)).length && r(i.splice(0, i.length));
            }, o.delay);
        };
    }, N = function(e, t) {
        return Array.isArray(e) ? t(e.map(function(e) {
            return i(i({}, e), {
                msg: "string" == typeof e.msg ? e.msg : [].concat(e.msg).map(f).join(" ")
            });
        })) : t(i(i({}, e), {
            msg: "string" == typeof e.msg ? e.msg : f(e.msg)
        }));
    }, j = function(e) {
        var t, n = !1, i = !1, o = !1, r = [];
        return e.lifeCycle.on("onConfigChange", function() {
            t && clearTimeout(t), t = setTimeout(function() {
                var t;
                !o && e.config && (o = !0, (t = void 0 === (t = e.config.whiteListUrl) ? "" : t) && e.send({
                    url: t,
                    type: g.WHITE_LIST
                }, function(t) {
                    i = !0;
                    try {
                        var o = t.data || JSON.parse(t), s = o.retcode, a = o.result, u = void 0 === a ? {} : a;
                        if (0 === s) {
                            if (n = u.is_in_white_list, e.isWhiteList = n, u.shutdown) return void e.destroy();
                            0 <= u.rate && u.rate <= 1 && (e.config.random = u.rate);
                        }
                        e.isWhiteList && r.length ? _(e)(r.splice(0), function() {}) : !e.isWhiteList && r.length && (r.length = 0);
                        var c = e.config.onWhitelist;
                        "function" == typeof c && c(n);
                    } catch (t) {}
                }, function(t) {
                    "403 forbidden" === t && e.destroy(), i = !0;
                }), o = !1);
            }, e.config.uin ? 50 : 500);
        }), e.lifeCycle.on("destroy", function() {
            r.length = 0;
        }), function(e, t) {
            n ? t(e.concat(r.splice(0)).map(function(e) {
                return O(e), e;
            })) : (e = e.filter(function(e) {
                return e.level !== p.INFO && e.level !== p.API_RESPONSE ? (O(e), !0) : (i || (r.push(e), 
                200 <= r.length && (r.length = 200)), !1);
            })).length && t(e);
        };
    }, A = function(e) {
        return setTimeout(function() {
            var t;
            (t = void 0 === (t = e.config.pvUrl) ? "" : t) && e.send({
                url: t,
                type: g.PV
            }, function() {}, function(t) {
                "403 forbidden" === t && e.destroy();
            });
        }, 100), function(e, t) {
            t(e);
        };
    }, U = function(t) {
        var n = {};
        return function(i, o) {
            var r, s;
            t.speedSample ? (s = "object" == e(t.repeat) ? t.repeat : {
                repeat: t.repeat
            }, r = +s.speed || +s.repeat || 5, Array.isArray(i) ? (s = i.filter(function(e) {
                var t = !n[e.url] || n[e.url] < r;
                return n[e.url] = 1 + ~~n[e.url], t;
            })).length && o(s) : (!n[i.url] || n[i.url] < r) && (n[i.url] = 1 + ~~n[i.url], 
            o(i))) : o(i);
        };
    }, I = function(e) {
        var t = {};
        return function(n, i) {
            var o = "number" == typeof e.repeat ? e.repeat : 5;
            if (0 === o) return i(n);
            i(n.filter(function(e) {
                return e.level !== p.ERROR && e.level !== p.PROMISE_ERROR && e.level !== p.AJAX_ERROR && e.level !== p.SCRIPT_ERROR && e.level !== p.IMAGE_ERROR && e.level !== p.CSS_ERROR && e.level !== p.MEDIA_ERROR || (t[e.msg] = t[e.msg] || 0, 
                t[e.msg] += 1, !(t[e.msg] > o));
            }));
        };
    }, _ = function(e) {
        return function(t, n) {
            return e.send({
                url: e.config.url || "",
                data: (i = t, (i = Array.isArray(i) ? i : [ i ]).map(function(e, t) {
                    return Object.getOwnPropertyNames(e).map(function(n) {
                        return r(n) + "[" + t + "]=" + (void 0 === e[n] ? "" : r(e[n]));
                    }).join("&");
                }).join("&") + (i.length ? "&count=" + i.length : "")),
                method: "post",
                contentType: "application/x-www-form-urlencoded",
                type: g.LOG,
                log: t
            }, function() {
                var i = e.config.onReport;
                "function" == typeof i && t.forEach(function(e) {
                    i(e);
                }), "function" == typeof n && n([]);
            }, function(t) {
                "403 forbidden" === t && e.destroy();
            });
            var i;
        };
    }, q = function(e) {
        if (!e || !e.reduce || !e.length) throw new TypeError("createPipeline need at least one function param");
        return 1 === e.length ? function(t, n) {
            e[0](t, n || R);
        } : e.reduce(function(e, t) {
            return function(n, i) {
                return void 0 === i && (i = R), e(n, function(e) {
                    return null == t ? void 0 : t(e, i);
                });
            };
        });
    }, F = (Object.defineProperty(ce.prototype, "__version__", {
        get: function() {
            return console.warn("__version__ has discard, please use version"), "1.24.49";
        },
        enumerable: !1,
        configurable: !0
    }), Object.defineProperty(ce.prototype, "LogType", {
        get: function() {
            return console.warn("LogType has discard, please use logType"), p;
        },
        enumerable: !1,
        configurable: !0
    }), ce.prototype.init = function(e) {
        this.setConfig(e);
        for (var t = 0; t < ce.installedPlugins.length; t++) try {
            ce.installedPlugins[t].patch(this);
        } catch (e) {
            this.sendSDKError(e);
        }
        this.lifeCycle.emit("onInited");
    }, ce.prototype.setConfig = function(e) {
        Object.assign(this.config, e);
        var t = (a = this.config).id, n = a.uin, i = a.version, o = a.ext1, r = a.ext2, s = a.ext3, a = (e = a.aid, 
        this.bean.id !== t || this.bean.uin !== n || this.bean.aid !== e);
        return this.bean.id = t || "", this.bean.uin = n || "", this.bean.version = i || "1.24.49", 
        this.bean.aid = e || "", o && (this.bean.ext1 = o), r && (this.bean.ext2 = r), s && (this.bean.ext3 = s), 
        a && this.lifeCycle.emit("onConfigChange", this.config), this.config;
    }, ce.use = function(e) {
        -1 === ce.installedPlugins.indexOf(e) && e.aegisPlugin && ce.installedPlugins.push(e);
    }, ce.unuse = function(e) {
        -1 !== (e = ce.installedPlugins.indexOf(e)) && ce.installedPlugins.splice(e, 1);
    }, ce.prototype.info = function() {
        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
        var n = {
            level: p.INFO,
            msg: e
        };
        1 === e.length && e[0].msg && Object.assign(n, i({}, e[0]), {
            level: p.INFO
        }), this.normalLogPipeline(n);
    }, ce.prototype.infoAll = function() {
        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
        var n = {
            level: p.INFO_ALL,
            msg: e
        };
        1 === e.length && e[0].msg && Object.assign(n, i({}, e[0]), {
            level: p.INFO_ALL
        }), this.normalLogPipeline(n);
    }, ce.prototype.report = function() {
        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
        var n = {
            level: p.REPORT,
            msg: e
        };
        1 === e.length && e[0].msg && Object.assign(n, i({}, e[0])), this.normalLogPipeline(n);
    }, ce.prototype.error = function() {
        for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
        var n = {
            level: p.ERROR,
            msg: e
        };
        1 === e.length && e[0].msg && Object.assign(n, i({}, e[0]), {
            level: p.ERROR
        }), this.normalLogPipeline(n);
    }, ce.prototype.speedLogPipeline = function(e) {
        throw new Error('You need to override "speedLogPipeline" method');
    }, ce.prototype.reportPv = function(e) {
        var t, n = this;
        e && (console.warn("reportPv is deprecated, please use reportEvent"), t = "" + Object.getOwnPropertyNames(this.bean).filter(function(e) {
            return "id" !== e;
        }).map(function(e) {
            return e + "=" + n.bean[e];
        }).join("&"), this.send({
            url: this.config.url + "/" + e + "?" + t,
            addBean: !1,
            type: g.CUSTOM_PV
        }, function() {}, function(e) {
            "403 forbidden" === e && n.destroy();
        }));
    }, ce.prototype.reportEvent = function(e) {
        e && ((e = "string" == typeof e ? {
            name: e,
            ext1: this.config.ext1 || "",
            ext2: this.config.ext2 || "",
            ext3: this.config.ext3 || ""
        } : e).name ? this.eventPipeline(e) : console.warn("reportEvent params error"));
    }, ce.prototype.reportTime = function(t, n) {
        if ("object" == e(t)) return this.reportT(t);
        "string" == typeof t ? "number" == typeof n ? n < 0 || 6e4 < n ? console.warn("reportTime: duration must between 0 and 60000") : this.submitCustomTime(t, n) : console.warn("reportTime: second param must be number") : console.warn("reportTime: first param must be a string");
    }, ce.prototype.reportT = function(e) {
        var t = e.name, n = e.duration, i = void 0 === (o = e.ext1) ? "" : o, o = void 0 === (r = e.ext2) ? "" : r, r = void 0 === (r = e.ext3) ? "" : r;
        e = e.from;
        if ("string" == typeof t && "number" == typeof n && "string" == typeof i && "string" == typeof o && "string" == typeof r) {
            if (!(n < 0 || 6e4 < n)) return this.submitCustomTime(t, n, i, o, r, void 0 === e ? "" : e);
            console.warn("reportTime: duration must between 0 and 60000");
        } else console.warn("reportTime: params error");
    }, ce.prototype.time = function(e) {
        "string" == typeof e ? this.timeMap[e] ? console.warn("Timer " + e + " already exists") : this.timeMap[e] = Date.now() : console.warn("time: first param must be a string");
    }, ce.prototype.timeEnd = function(e) {
        "string" == typeof e ? this.timeMap[e] ? (this.submitCustomTime(e, Date.now() - this.timeMap[e]), 
        delete this.timeMap[e]) : console.warn("Timer " + e + " does not exist") : console.warn("timeEnd: first param must be a string");
    }, ce.prototype.submitCustomTime = function(e, t, n, i, o, r) {
        this.customTimePipeline({
            name: e,
            duration: t,
            ext1: n || this.config.ext1,
            ext2: i || this.config.ext2,
            ext3: o || this.config.ext3,
            from: r || void 0
        });
    }, ce.prototype.extendBean = function(e, t) {
        this.bean[e] = t;
    }, ce.prototype.send = function(e, t, n) {
        var i, o, r, s = this;
        q([ (o = e.type, function(e, t) {
            if (!e) return t(e);
            e = Array.isArray(e) ? e : [ e ], i.lifeCycle.emit("beforeRequest", e);
            var n = i.config.beforeRequest;
            (e = "function" == typeof n ? e.filter(function(e) {
                return !1 !== n({
                    logs: e,
                    logType: o
                });
            }) : e).length && t(e);
        }), function(i, o) {
            s.request(e, function() {
                for (var n = [], r = 0; r < arguments.length; r++) n[r] = arguments[r];
                o({
                    isErr: !1,
                    result: n,
                    logType: e.type,
                    logs: i
                }), null == t || t.apply(void 0, n);
            }, function() {
                for (var t = [], r = 0; r < arguments.length; r++) t[r] = arguments[r];
                o({
                    isErr: !0,
                    result: t,
                    logType: e.type,
                    logs: i
                }), null == n || n.apply(void 0, t);
            });
        }, (r = i = this, function(e, t) {
            r.lifeCycle.emit("afterRequest", e);
            var n = r.config.afterRequest;
            "function" == typeof n && !1 === n(e) || t(e);
        }) ])(e.log);
    }, ce.prototype.request = function(e, t, n) {
        throw new Error('You need to override "request" method');
    }, ce.prototype.sendSDKError = function(e) {
        this.send({
            url: this.config.url + "?id=1085&msg[0]=" + encodeURIComponent(f(e)) + "&level[0]=2&from=" + this.config.id + "&count=1&version=" + this.config.id + "(1.24.49)",
            addBean: !1,
            method: "get",
            type: g.SDK_ERROR
        });
    }, ce.prototype.destroy = function(e) {
        void 0 === e && (e = !1);
        var t, n, i = ce.instances.indexOf(this);
        -1 !== i && ce.instances.splice(i, 1);
        for (var o = ce.installedPlugins.length - 1; 0 <= o; o--) try {
            ce.installedPlugins[o].unpatch(this);
        } catch (e) {
            this.sendSDKError(e);
        }
        if (this.lifeCycle.emit("destroy"), this.lifeCycle.clear(), e) t = this, n = Object.getOwnPropertyDescriptors(t), 
        Object.keys(n).forEach(function(e) {
            n[e].writable && (t[e] = null);
        }), Object.setPrototypeOf(this, null); else {
            for (var r = this; r.constructor !== Object && P(r, this), r = Object.getPrototypeOf(r); ) ;
            0 === ce.instances.length && (P(e = Object.getPrototypeOf(this).constructor), P(ce));
        }
    }, ce.version = "1.24.49", ce.instances = [], ce.logType = p, ce.installedPlugins = [], 
    ce), M = (ue.prototype.patch = function(e) {
        this.canUse(e) && this.exist(e) && (this.instances.push(e), this.triggerInit(e), 
        this.triggerOnNewAegis(e));
    }, ue.prototype.unpatch = function(e) {
        -1 !== (e = this.instances.indexOf(e)) && this.instances.splice(e, 1);
    }, ue.prototype.countInstance = function() {
        return this.instances.length;
    }, ue.prototype.uninstall = function() {
        var e;
        null === (e = null === (e = this.option) || void 0 === e ? void 0 : e.destroy) || void 0 === e || e.apply(this);
    }, ue.prototype.walk = function(e) {
        var t = this;
        this.instances.forEach(function(n) {
            var i = t.canUse(n);
            i && e(n, i);
        });
    }, ue.prototype.canUse = function(t) {
        return !(!(t = this.getConfig(t)) || "object" != e(t)) || !!t;
    }, ue.prototype.getConfig = function(e) {
        return null === (e = e.config) || void 0 === e ? void 0 : e[this.name];
    }, ue.prototype.exist = function(e) {
        return -1 === this.instances.indexOf(e);
    }, ue.prototype.triggerInit = function(e) {
        var t;
        this.inited || (this.inited = !0, null === (t = null === (t = this.option) || void 0 === t ? void 0 : t.init) || void 0 === t || t.call(this.option, this.getConfig(e)));
    }, ue.prototype.triggerOnNewAegis = function(e) {
        var t;
        null === (t = null === (t = this.option) || void 0 === t ? void 0 : t.onNewAegis) || void 0 === t || t.call(this.option, e, this.getConfig(e));
    }, ue), D = wx || qq, H = function(e) {
        return function(e, t) {
            if ("string" == typeof e) {
                if (e === t) return 1;
                for (var n = e.split("."), i = t.split("."), o = Math.max(n.length, i.length), r = 0; r < o; r++) {
                    var s = ~~n[r], a = ~~i[r];
                    if (s < a) return;
                    if (a < s) return 1;
                }
            }
        }(D.getSystemInfoSync().SDKVersion, "1.1.1") && D.canIUse ? D.canIUse(e) : !!D[e];
    }, B = new M({
        name: "offlineLog",
        onNewAegis: function(e) {
            if (D.getFileSystemManager) try {
                var t = e.config, n = t.id, i = void 0 === n ? "" : n, o = t.uin, r = void 0 === o ? 0 : o, s = t.offlineUrl, a = void 0 === s ? "" : s, u = t.offlineLogLimit, c = new J({
                    limit: u
                });
                e.lifeCycle.on("beforeWrite", function(t) {
                    c.save2Offline(t = void 0 === t ? [] : t, e.config);
                }), c.ready(function(t) {
                    var n = (e.bean || {}).aid, o = void 0 === n ? "" : n;
                    !t && i && (r || o) && e.send({
                        url: a + "/offlineAuto"
                    }, function(n) {
                        var s = (null == n ? void 0 : n.data).secretKey;
                        s && (t || c.getLogs({
                            id: i,
                            uin: r
                        }, function(t, n) {
                            t ? console.error(t) : e.send({
                                url: a + "/offlineLog",
                                data: {
                                    logs: n,
                                    secretKey: s,
                                    id: i,
                                    uin: r,
                                    aid: o
                                },
                                method: "post"
                            }, function() {
                                c.clearLogs();
                            });
                        }));
                    });
                });
            } catch (e) {
                console.error(e);
            } else console.warn("[aegis-mp-sdk]unsupport getFileSystemManager offline log not work!");
        }
    }), J = (ae.prototype.getLogs = function(e, t) {
        var n = this.fileSystem, i = this.filePath;
        n.readFile({
            filePath: i,
            encoding: "utf8",
            fail: function(e) {
                console.error(e);
            },
            success: function(e) {
                e = (void 0 === (e = e.data) ? "" : e).toString().split("\n").filter(function(e) {
                    return e;
                }).map(function(e) {
                    return JSON.parse(e);
                }), t(null, e);
            }
        });
    }, ae.prototype.checkLimit = function(e, t) {
        void 0 === t && (t = function() {});
        var n = this.fileSystem, i = this.filePath, o = this.limitSize;
        n.readFile({
            filePath: i,
            encoding: "utf8",
            success: function(r) {
                if ((r = (r = void 0 === (r = r.data) ? "" : r).toString() + e).length > o) {
                    for (var s = r.split("\n"), a = "", u = s.length - 1; 0 <= u && !(s[u] && (a = s[u] + "\n" + a).length > o); u--) ;
                    n.writeFile({
                        filePath: i,
                        data: a,
                        success: t
                    });
                } else n.appendFile({
                    data: e,
                    filePath: i,
                    encoding: "utf8",
                    success: t,
                    fail: function(e) {
                        console.error(e);
                    }
                });
            }
        });
    }, ae), V = function(e) {
        for (var t, n = {
            unknown: /unknown|none/i,
            wifi: /wifi/i,
            net2g: /2g/i,
            net3g: /3g/i,
            net4g: /4g/i,
            net5g: /5g/i,
            net6g: /6g/i
        }, i = h.unknown, o = 0; o < Object.keys(n).length; o++) {
            var r = Object.keys(n)[o];
            if (null !== (t = n[r]) && void 0 !== t && t.test(e)) {
                i = h[r];
                break;
            }
        }
        return i;
    }, W = new M({
        name: "device",
        onNewAegis: function(e) {
            return t = this, o = function() {
                return n = this, i = function(t) {
                    return this.setSystemInfo(e), this.refreshNetwork(e), this.setNetworkChange(e), 
                    [ 2 ];
                }, a = {
                    label: 0,
                    sent: function() {
                        if (1 & s[0]) throw s[1];
                        return s[1];
                    },
                    trys: [],
                    ops: []
                }, u = {
                    next: t(0),
                    throw: t(1),
                    return: t(2)
                }, "function" == typeof Symbol && (u[Symbol.iterator] = function() {
                    return this;
                }), u;
                function t(e) {
                    return function(t) {
                        return function(e) {
                            if (o) throw new TypeError("Generator is already executing.");
                            for (;a; ) try {
                                if (o = 1, r && (s = 2 & e[0] ? r.return : e[0] ? r.throw || ((s = r.return) && s.call(r), 
                                0) : r.next) && !(s = s.call(r, e[1])).done) return s;
                                switch (r = 0, (e = s ? [ 2 & e[0], s.value ] : e)[0]) {
                                  case 0:
                                  case 1:
                                    s = e;
                                    break;

                                  case 4:
                                    return a.label++, {
                                        value: e[1],
                                        done: !1
                                    };

                                  case 5:
                                    a.label++, r = e[1], e = [ 0 ];
                                    continue;

                                  case 7:
                                    e = a.ops.pop(), a.trys.pop();
                                    continue;

                                  default:
                                    if (!((s = 0 < (s = a.trys).length && s[s.length - 1]) || 6 !== e[0] && 2 !== e[0])) {
                                        a = 0;
                                        continue;
                                    }
                                    if (3 === e[0] && (!s || e[1] > s[0] && e[1] < s[3])) {
                                        a.label = e[1];
                                        break;
                                    }
                                    if (6 === e[0] && a.label < s[1]) {
                                        a.label = s[1], s = e;
                                        break;
                                    }
                                    if (s && a.label < s[2]) {
                                        a.label = s[2], a.ops.push(e);
                                        break;
                                    }
                                    s[2] && a.ops.pop(), a.trys.pop();
                                    continue;
                                }
                                e = i.call(n, a);
                            } catch (t) {
                                e = [ 6, t ], r = 0;
                            } finally {
                                o = s = 0;
                            }
                            if (5 & e[0]) throw e[1];
                            return {
                                value: e[0] ? e[1] : void 0,
                                done: !0
                            };
                        }([ e, t ]);
                    };
                }
                var n, i, o, r, s, a, u;
            }, new (i = (i = n = void 0) || Promise)(function(e, r) {
                function s(e) {
                    try {
                        u(o.next(e));
                    } catch (e) {
                        r(e);
                    }
                }
                function a(e) {
                    try {
                        u(o.throw(e));
                    } catch (e) {
                        r(e);
                    }
                }
                function u(t) {
                    var n;
                    t.done ? e(t.value) : ((n = t.value) instanceof i ? n : new i(function(e) {
                        e(n);
                    })).then(s, a);
                }
                u((o = o.apply(t, n || [])).next());
            });
            var t, n, i, o;
        },
        setSystemInfo: function(e) {
            var t = this;
            try {
                H("getSystemInfo") && D.getSystemInfo({
                    success: function(n) {
                        var i = n.platform;
                        n = n.model;
                        e.extendBean("platform", t.getPlatFormType(i)), e.extendBean("model", n);
                    }
                });
            } catch (e) {}
        },
        getPlatFormType: function(e) {
            for (var t, n = {
                android: /android/i,
                ios: /ios/i,
                windows: /windows/i,
                macos: /mac/i,
                devtools: /devtools/i
            }, i = d.other, o = 0; o < Object.keys(n).length; o++) {
                var r = Object.keys(n)[o];
                if (null !== (t = n[r]) && void 0 !== t && t.test(e)) {
                    i = d[r];
                    break;
                }
            }
            return i;
        },
        setNetworkChange: function(e) {
            H("onNetworkStatusChange") && D.onNetworkStatusChange(function(t) {
                t = V(t.networkType), e.extendBean("netType", t);
            });
        },
        setNetworkType: function(e) {
            H("getNetworkType") && D.getNetworkType({
                success: function(t) {
                    t = V(t.networkType), e.extendBean("netType", t);
                }
            });
        },
        refreshNetwork: function(e) {
            var t = this;
            this.timer && clearTimeout(this.timer), this.setNetworkType(e), this.timer = setTimeout(function() {
                t.refreshNetwork(e);
            }, 1e4);
        }
    }), $ = D.request, K = (n(se, L = F), Object.defineProperty(se.prototype, "getBean", {
        get: function() {
            var e = this;
            return this.bean ? Object.getOwnPropertyNames(this.bean).map(function(t) {
                return t + "=" + e.bean[t];
            }).join("&") + "&from=" + encodeURIComponent(E()) : "from=" + encodeURIComponent(E());
        },
        enumerable: !1,
        configurable: !0
    }), se.prototype.initOfflineLog = function() {
        se.use(B);
    }, se.prototype.uploadLogs = function(e, t) {
        this.lifeCycle.emit("uploadLogs", e = void 0 === e ? {} : e, t = void 0 === t ? {} : t);
    }, se.prototype.reportPv = function(e) {
        var t, n = this;
        e && (t = Object.getOwnPropertyNames(this.bean).filter(function(e) {
            return "id" !== e;
        }).map(function(e) {
            return e + "=" + n.bean[e];
        }).join("&") + "&from=" + encodeURIComponent(E()), this.send({
            url: this.config.url + "/" + e + "?" + t,
            addBean: !1
        }, function() {}, function() {}));
    }, se.sessionID = "session-" + Date.now(), se.asyncPluginIndex = 0, se), G = new M({
        name: "aid",
        onNewAegis: function(e) {
            this.initAid(function(t) {
                e.bean.aid = t, e.config.aid = t;
            });
        },
        initAid: function(e) {
            D.getStorage({
                key: "AEGIS_ID",
                success: function(t) {
                    e(t.data);
                },
                fail: function() {
                    var t = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(e) {
                        var t = 16 * Math.random() | 0;
                        return ("x" === e ? t : 3 & t | 8).toString(16);
                    });
                    D.setStorage({
                        key: "AEGIS_ID",
                        data: t,
                        success: function() {
                            e(t);
                        }
                    });
                }
            });
        }
    }), Q = (re.prototype.prefixHandler = function(e) {
        e.aegisRequestStartTime = Date.now();
    }, re.prototype.successHandler = function(e, t) {
        var n;
        this.callbacks.forEach(function(n) {
            var i;
            try {
                null === (i = n.success) || void 0 === i || i.call(n, e, t);
            } catch (n) {}
        }), null === (n = t.success) || void 0 === n || n.call(t, e, t);
    }, re.prototype.failHandler = function(e, t) {
        var n;
        this.callbacks.forEach(function(n) {
            var i;
            try {
                null === (i = n.fail) || void 0 === i || i.call(n, e, t);
            } catch (n) {}
        }), null === (n = t.fail) || void 0 === n || n.call(t, e, t);
    }, re.prototype.completeHandler = function(e, t) {
        var n;
        this.callbacks.forEach(function(n) {
            var i;
            try {
                null === (i = n.complete) || void 0 === i || i.call(n, e, t);
            } catch (n) {}
        }), null === (n = t.complete) || void 0 === n || n.call(t, e, t);
    }, re.prototype.override = function() {
        try {
            this.defineApiProperty();
        } catch (e) {
            console.warn("cannot override `" + this.apiName + "`, error is: " + e);
        } finally {
            this.isOverride = !0;
        }
    }, re), X = wx || qq, z = X.request, Y = (n(oe, T = Q), oe.prototype.defineApiProperty = function() {
        var e = this;
        Object.defineProperty(X, "request", {
            get: function() {
                return e.hackHandler.bind(e);
            }
        });
    }, oe.prototype.hackHandler = function(e) {
        var t = this;
        return this.prefixHandler(e), new Promise(function(n, o) {
            z(i(i({}, e), {
                success: function(i) {
                    t.successHandler(i, e), n(i);
                },
                fail: function(n) {
                    t.failHandler(n, e), o(n);
                },
                complete: function(n) {
                    t.completeHandler(n, e);
                }
            }));
        });
    }, oe), Z = wx || qq, ee = null === (ne = Z.cloud) || void 0 === ne ? void 0 : ne.callFunction, te = (n(ie, S = Q), 
    ie.prototype.defineApiProperty = function() {
        var e = this;
        Z.cloud && Z.cloud.callFunction && Object.defineProperty(Z.cloud, "callFunction", {
            get: function() {
                return e.hackHandler.bind(e);
            }
        });
    }, ie.prototype.hackHandler = function(e) {
        var t = this;
        return this.prefixHandler(e), new Promise(function(n, o) {
            ee(i(i({}, e), {
                success: function(i) {
                    t.successHandler(i, e), n(i);
                },
                fail: function(n) {
                    t.failHandler(n, e), o(n);
                },
                complete: function(n) {
                    t.completeHandler(n, e);
                }
            }));
        });
    }, ie), ne = (F = new M({
        name: "reportApiSpeed",
        override: !1,
        onNewAegis: function(e) {
            this.override || (this.override = !0, this.hackRequest(e.config), this.overrideCallFunction(e.config));
        },
        hackRequest: function(t) {
            var n = this;
            x({
                success: function(i, o) {
                    var r = {
                        method: o.method || "get",
                        url: a(o.url),
                        duration: Date.now() - o.aegisRequestStartTime,
                        status: i.statusCode || 0,
                        isHttps: u(o.url),
                        type: "fetch"
                    }, s = null === (d = t.api) || void 0 === d ? void 0 : d.apiDetail, d = "req url: " + r.url + " \n                        \nreq method: " + r.method + " \n                        \nreq param: " + (s ? f(o.data) : "") + " \n                        \nres duration: " + r.duration + " \n                        \nres status: " + (i.statusCode || 0) + " \n                        \nres data: " + (s ? function t(n, i) {
                        void 0 === i && (i = 3);
                        var o, r, s, a = "";
                        return Array.isArray(n) ? (a += "[", o = n.length, n.forEach(function(n, r) {
                            a += "object" == e(n) && 1 < i ? t(n, i - 1) : y(n), a += r === o - 1 ? "" : ",";
                        }), a += "]") : n instanceof Object ? (a = "{", r = Object.keys(n), s = r.length, 
                        r.forEach(function(o, u) {
                            "object" == e(n[o]) && 1 < i ? a += '"' + o + '":' + t(n[o], i - 1) : a += v(o, n[o]), 
                            a += u === s - 1 || u < s - 1 && void 0 === n[r[u + 1]] ? "" : ",";
                        }), a += "}") : a += n, a;
                    }(i.data) : "");
                    n.publishNormalLog({
                        msg: d,
                        level: p.API_RESPONSE
                    }), n.publishSpeedLog(r), ("function" == typeof (null === (s = t.api) || void 0 === s ? void 0 : s.retCodeHandler) ? (o = (s = t.api.retCodeHandler(i.data, o.url, o, i) || {}).code, 
                    s = void 0 !== (s = s.isErr) && s, r.ret = void 0 === o ? 0 : o, s) : (i = c(i.data, t.api), 
                    r.ret = i, l(t, i))) && n.publishNormalLog({
                        msg: d,
                        level: p.RET_ERROR
                    });
                },
                fail: function(e, t) {
                    t = {
                        method: t.method || "get",
                        url: a(t.url),
                        duration: Date.now() - t.aegisRequestStartTime,
                        status: 0,
                        isHttps: u(t.url),
                        type: "fetch"
                    }, n.publishSpeedLog(t);
                }
            });
        },
        overrideCallFunction: function(e) {
            var t = this;
            new te({
                success: function(n, i) {
                    var o = {
                        method: "call",
                        url: "wx.cloud.callFunction." + i.name,
                        duration: Date.now() - i.aegisRequestStartTime,
                        status: 200,
                        type: "fetch",
                        errMsg: n.errMsg,
                        isHttps: !0
                    }, r = null === (s = e.api) || void 0 === s ? void 0 : s.apiDetail, s = "req url: " + o.url + "\n                        \nreq type: " + o.type + "\n                        \nres duration: " + o.duration + "\n                        \nres errMsg: " + o.errMsg + "\n                        \nres data: " + (r ? JSON.stringify(n.result) : "") + "\n                        ";
                    t.publishNormalLog({
                        msg: s,
                        level: p.API_RESPONSE
                    }), t.publishSpeedLog(o), ("function" == typeof (null === (r = e.api) || void 0 === r ? void 0 : r.retCodeCloudFunctionHandler) ? (i = (r = e.api.retCodeCloudFunctionHandler(n.result, i.name, i, n) || {}).code, 
                    r = void 0 !== (r = r.isErr) && r, o.ret = i, r) : (n = c(n.result, e.api), o.ret = n, 
                    l(e, n))) && t.publishNormalLog({
                        msg: s,
                        level: p.RET_ERROR
                    });
                },
                fail: function(e, n) {
                    e = {
                        method: "call",
                        url: "wx.cloud.callFunction." + n.name,
                        duration: Date.now() - n.aegisRequestStartTime,
                        status: 0,
                        type: "fetch",
                        errMsg: e.errMsg,
                        isHttps: !0
                    }, t.publishSpeedLog(e);
                }
            });
        },
        publishSpeedLog: function(e) {
            this.$walk(function(t) {
                t.speedLogPipeline(e);
            });
        },
        publishNormalLog: function(e) {
            this.$walk(function(t) {
                t.normalLogPipeline(e);
            });
        }
    }), new M({
        name: "onError",
        onNewAegis: function(e) {
            e = e.config, this.listenError(), this.hackRequest(e);
        },
        listenError: function() {
            var e = this;
            D.onError(function(t) {
                t && e.publishErrorLog({
                    msg: t,
                    level: p.ERROR
                });
            }), H("onUnhandledRejection") && D.onUnhandledRejection(function(t) {
                (t = t.reason) && e.publishErrorLog({
                    msg: t,
                    level: p.PROMISE_ERROR
                });
            });
        },
        publishErrorLog: function(e) {
            this.$walk(function(t) {
                t.normalLogPipeline(e);
            });
        },
        hackRequest: function(e) {
            var t = this;
            x({
                complete: function(n, i) {
                    var o, r = n.errMsg, s = n.statusCode, a = n.data;
                    n = null === (n = e.api) || void 0 === n ? void 0 : n.apiDetail;
                    e.hostUrl && -1 < (null === (o = i.url) || void 0 === o ? void 0 : o.indexOf(e.hostUrl)) || (o = "", 
                    -1 < r.indexOf("timeout") ? o = "timeout" : -1 < r.indexOf("fail") || !s || s < 0 ? o = "failed" : 400 <= s && (o = "error"), 
                    o && t.publishErrorLog({
                        msg: "AJAX_ERROR: request " + o + "\n                  \nres status: " + (s || 0) + "\n                  \nres duration: " + (Date.now() - i.aegisRequestStartTime) + "\n                  \nres data: " + (n ? f(a) : "") + "\n                  \nreq url: " + i.url + "\n                  \nreq method: " + (i.method || "get") + "\n                  \nreq param: " + (n ? f(i.data) : "") + "\n                  \nerrMsg: " + r.slice(0, 1e3),
                        level: p.AJAX_ERROR
                    }));
                }
            });
        }
    }));
    Q = new M({
        name: "reportAssetSpeed",
        isStart: !1,
        onNewAegis: function(e) {
            this.isStart || (this.isStart = !0, this.start(e));
        },
        start: function() {
            var e = this;
            D.getPerformance && D.getPerformance().createObserver(function(t) {
                t.getEntries().forEach(function(t) {
                    !t.duration || t.duration <= 0 || "script" === t.entryType && e.publishAssetLog(t);
                });
            }).observe({
                entryTypes: [ "script" ]
            });
        },
        generateLog: function(e) {
            return {
                url: a(e.path || e.moduleName) + "js",
                method: "get",
                duration: Number(e.duration.toFixed(2)),
                status: 200,
                type: "static",
                isHttps: !0,
                urlQuery: "",
                domainLookup: 0,
                connectTime: 0
            };
        },
        publishAssetLog: function(e) {
            var t = this;
            this.$walk(function(n) {
                n.speedLogPipeline(t.generateLog(e));
            });
        }
    }), M = new M({
        name: "pagePerformance",
        onNewAegis: function(e) {
            try {
                H("getPerformance") && this.reportPerformance(e), this.setPagePV(e), this.reportSetDataTiming(e);
            } catch (e) {}
        },
        reportPerformance: function(e) {
            var t, n = this;
            null == (t = null == (t = D.getPerformance()) ? void 0 : t.createObserver(function(t) {
                var i = {}, o = (s = t.getEntries()).find(function(e) {
                    return "appLaunch" === e.name && 0 < e.duration;
                }), r = s.find(function(e) {
                    return "firstRender" === e.name && 0 < e.duration;
                }), s = (t = s.find(function(e) {
                    return "evaluateScript" === e.name && 0 < e.duration;
                }), s.find(function(e) {
                    return "route" === e.name && 0 < e.duration;
                }));
                o && (i.appLaunch = o.duration), r && (i.firstScreenTiming = r.duration), t && (i.scriptEvaluateTiming = t.duration), 
                s && (i.pageRouteTiming = s.duration), n.publish(i, e);
            })) || t.observe({
                entryTypes: [ "navigation", "render", "script" ]
            });
        },
        publish: function(e, t) {
            var n, i, o = [], r = this.$getConfig(t), s = -1 === (null === (n = t.config.performanceUrl) || void 0 === n ? void 0 : n.indexOf("?")) ? "?" : "&";
            for (i in e) o.push(i + "=" + e[i]);
            "function" == typeof r.urlHandler ? this.$walk(function(e) {
                e.send({
                    url: t.config.performanceUrl + s + o.join("&") + "&from=" + (encodeURIComponent(r.urlHandler()) || window.location.href),
                    beanFilter: [ "from" ],
                    type: g.PERFORMANCE
                });
            }) : this.$walk(function(e) {
                e.send({
                    url: t.config.performanceUrl + s + o.join("&"),
                    type: g.PERFORMANCE
                });
            });
        },
        setPagePV: function(e) {
            var t = this;
            D.onAppRoute && D.onAppRoute(function(e) {
                "appLaunch" !== e.openType && t.$walk(function(e) {
                    e.send({
                        url: "" + e.config.pvUrl,
                        type: g.PV
                    });
                });
            });
        },
        reportSetDataTiming: function(e) {
            var t = q([ k(e, 5), function(t) {
                t = t.map(function(e) {
                    return {
                        component: e.from,
                        duration: e.duration,
                        fields: e.dataPaths.sort().join(";")
                    };
                }), e.send({
                    url: e.config.customTimeUrl + "?payload=" + encodeURIComponent(JSON.stringify({
                        miniProgramData: t
                    })),
                    type: g.CUSTOM,
                    log: t
                });
            } ]), n = Page, i = Component, o = e.config.updatePerformanceReportThreshold;
            (!o || isNaN(+o) || o < 5) && (o = 5), Page = function(e) {
                var i = e.onReady;
                return e.onReady = function() {
                    var e = this;
                    return "function" == typeof this.setUpdatePerformanceListener && this.setUpdatePerformanceListener({
                        withDataPaths: !0
                    }, function(n) {
                        var i = n.updateStartTimestamp, r = n.updateEndTimestamp;
                        n = void 0 === (n = n.dataPaths) ? [] : n, i = r - i;
                        isNaN(i) || i < o || (n = {
                            duration: i,
                            from: e.is,
                            dataPaths: n
                        }, t(n));
                    }), null == i ? void 0 : i.call(this);
                }, n(e);
            }, Component = function(e) {
                var n = e.attached;
                return e.attached = function() {
                    var e = this;
                    return "function" == typeof this.setUpdatePerformanceListener && this.setUpdatePerformanceListener({
                        withDataPaths: !0
                    }, function(n) {
                        var i = n.updateStartTimestamp, r = n.updateEndTimestamp;
                        n = n.dataPaths, i = r - i;
                        isNaN(i) || i < o || (n = {
                            duration: i,
                            from: e.is,
                            dataPaths: n
                        }, t(n));
                    }), null == n ? void 0 : n.call(this);
                }, i(e);
            };
        }
    });
    function ie() {
        return null !== S && S.apply(this, arguments) || this;
    }
    function oe() {
        return null !== T && T.apply(this, arguments) || this;
    }
    function re(e) {
        this.isOverride = !1, this.callbacks = [], this.isOverride || this.override(), this.callbacks.push(e);
    }
    function se(t) {
        var n, i = L.call(this, t) || this;
        i.originRequest = $, i.speedLogPipeline = q([ U(i.config), k(i), (n = i, function(e, t) {
            H("getNetworkType") ? D.getNetworkType({
                success: function(i) {
                    i = V(i.networkType), n.extendBean("netType", i), t(e);
                }
            }) : t(e);
        }), function(e, t) {
            i.lifeCycle.emit("beforeReportSpeed", e);
            var n = i.config.beforeReportSpeed;
            if ((e = "function" == typeof n ? e.filter(function(e) {
                return !1 !== n(e);
            }) : e).length) return t(e);
        }, function(e) {
            i.send({
                url: "" + i.config.speedUrl,
                method: "post",
                data: b(e, i.bean)
            });
        } ]), i.requestQueue = [], i.requesting = !1, i.request = function(t, n, o) {
            if (t.url && i.bean.id) if (/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/.test(String(i.bean.aid))) {
                if (!(i.requesting || H("getNetworkType") && void 0 === i.bean.netType)) {
                    i.requesting = !0;
                    var r, s = t.url;
                    i.config.whiteListUrl === s && (r = n, n = function(e) {
                        null == r || r(JSON.stringify(e.data));
                    }), !1 !== t.addBean && (s = s + (-1 === s.indexOf("?") ? "?" : "&") + i.getBean);
                    var a = t.method || "get", u = function() {
                        i.requesting = !1;
                        var e = i.requestQueue.shift();
                        e && i.send(e.options, e.success, e.fail);
                    }, c = t, l = i.config.onBeforeRequest;
                    if (!(c = l ? l(t, i) : c) || !c.url) {
                        var f = "";
                        return c || (f = "Sending request blocked", console.log(f)), c.url || (f = "Please handle the parameters reasonably, options.url is necessary", 
                        console.warn(f)), null == o || o(f), u(), !1;
                    }
                    return f = i.config.enableHttp2 || !1, "get" === a ? (s = function(t, n) {
                        if ("string" != typeof t) return "";
                        if ("object" == e(n) && n) {
                            var i = Object.getOwnPropertyNames(n).map(function(e) {
                                var t = n[e];
                                return e + "=" + ("string" == typeof t ? encodeURIComponent(t) : encodeURIComponent(JSON.stringify(t)));
                            }).join("&").replace(/eval/gi, "evaI");
                            return t + (-1 === t.indexOf("?") ? "?" : "&") + i;
                        }
                        return t;
                    }(s, c.data), i.originRequest({
                        url: s,
                        enableHttp2: f,
                        success: n,
                        fail: o,
                        complete: u
                    })) : ("string" == typeof c.data && (c.data = c.data.replace(/eval/gi, "evaI")), 
                    i.originRequest({
                        url: s,
                        enableHttp2: f,
                        header: c.contentType ? {
                            "content-type": c.contentType
                        } : void 0,
                        method: "POST",
                        data: c.data,
                        success: n,
                        fail: o,
                        complete: u
                    })), !0;
                }
                i.requestQueue.push({
                    options: t,
                    success: n,
                    fail: o
                });
            } else i.requestQueue.push({
                options: t,
                success: n,
                fail: o
            });
        };
        try {
            t.offlineLog && i.initOfflineLog(), i.init(t), i.extendBean("sessionId", se.sessionID), 
            i.extendBean("referer", (H("getLaunchOptionsSync") ? D.getLaunchOptionsSync() : {
                scene: ""
            }).scene || "");
        } catch (t) {
            console.warn(t), console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.", "color: red"), 
            i.sendSDKError(t);
        }
        return i;
    }
    function ae(e) {
        var t, n, i = this, o = (e = void 0 === (e = (o = void 0 === e ? {} : e).path) ? "/.aegis.offline.log" : e, 
        void 0 === (o = o.limit) ? 2e4 : o);
        this.offlineBuffer = [], this.insertLog = (t = null, n = [], function(e) {
            n = n.concat(e), t = t || setTimeout(function() {
                t = null;
                var e, o = i.fileSystem, r = i.filePath, s = n.map(function(e) {
                    return JSON.stringify(e);
                }).join("\n") + "\n";
                s && (e = function(e) {
                    e ? i.checkLimit(s, function() {
                        n = [];
                    }) : o.writeFile({
                        data: s,
                        filePath: r,
                        encoding: "utf8",
                        fail: function(e) {
                            console.error(e);
                        },
                        success: function() {
                            n = [];
                        }
                    });
                }, o.access({
                    path: r,
                    success: function() {
                        e(!0);
                    },
                    fail: function() {
                        e();
                    }
                }));
            }, 2e3);
        }), this.ready = function(e) {
            i.fileSystem ? setTimeout(function() {
                e(null);
            }, 0) : (e(new Error("getFileSystemManager file")), i.offlineLog = !1);
        }, this.clearLogs = function() {
            var e = i.fileSystem, t = i.filePath;
            e.writeFile({
                filePath: t,
                data: "",
                fail: function() {
                    e.unlinkSync(t);
                }
            });
        }, this.save2Offline = function(e, t) {
            e = (e = Array.isArray(e) ? e : [ e ]).map(function(e) {
                return "string" == typeof e && (e = {
                    msg: e
                }), function() {
                    for (var e = [], t = 0; t < arguments.length; t++) e[t] = arguments[t];
                    if (0 === e.length) throw new TypeError("Cannot convert undefined or null to object");
                    for (var n = Object(e[0]), i = 1; i < e.length; i++) {
                        var o = e[i];
                        if (null !== o) for (var r in o) Object.prototype.hasOwnProperty.call(o, r) && (n[r] = o[r]);
                    }
                    return n;
                }({
                    id: t.id,
                    uin: t.uin,
                    time: +Date.now(),
                    version: t.version,
                    from: E()
                }, e);
            }), i.fileSystem ? i.insertLog(e) : (i.fileSystem || i.offlineBuffer.length || i.ready(function(e) {
                e ? console.error(e) : i.offlineBuffer.length && (i.addLogs(i.offlineBuffer), i.offlineBuffer = []);
            }), i.offlineBuffer = i.offlineBuffer.concat(e));
        }, this.addLogs = function(e) {
            i.fileSystem && i.insertLog(e);
        }, this.filePath = D.env.USER_DATA_PATH + e, this.fileSystem = D.getFileSystemManager(), 
        this.limitSize = o;
    }
    function ue(e) {
        this.aegisPlugin = !0, this.name = "", this.instances = [], this.inited = !1, e.$walk = this.walk.bind(this), 
        e.$getConfig = this.getConfig.bind(this), this.option = e, this.name = e.name;
    }
    function ce(e) {
        var t, n, i = this;
        this.config = {
            version: 0,
            delay: 1e3,
            onError: !0,
            repeat: 5,
            random: 1,
            aid: !0,
            device: !0,
            pagePerformance: !0,
            webVitals: !0,
            speedSample: !0,
            hostUrl: "https://aegis.qq.com",
            url: "",
            offlineUrl: "",
            whiteListUrl: "",
            pvUrl: "",
            speedUrl: "",
            customTimeUrl: "",
            performanceUrl: "",
            webVitalsUrl: "",
            eventUrl: ""
        }, this.isWhiteList = !1, this.lifeCycle = new o(), this.bean = {}, this.normalLogPipeline = q([ k(this, 5), N, function(e, n) {
            if ("number" != typeof t.config.random && (console.warn("random must in [0, 1], default is 1."), 
            t.config.random = 1), Math.random() < t.config.random) return n(e);
        }, I((t = this).config), C(this.lifeCycle.emit, this.config), A(this), j(this), function(e, t) {
            var n = JSON.parse(JSON.stringify(e));
            i.lifeCycle.emit("beforeReport", n);
            var o = i.config.beforeReport;
            (e = "function" == typeof o ? e.filter(function(e) {
                return !1 !== o(e);
            }) : e).length && t(e);
        }, _(this) ]), this.eventPipeline = q([ k(this, 5), function(e) {
            var t = e.map(function(e) {
                return {
                    name: e.name,
                    ext1: e.ext1 || i.config.ext1 || "",
                    ext2: e.ext2 || i.config.ext2 || "",
                    ext3: e.ext3 || i.config.ext3 || ""
                };
            });
            return i.send({
                url: i.config.eventUrl + "?payload=" + encodeURIComponent(JSON.stringify(t)),
                type: g.EVENT,
                log: e
            }, function() {}, function(e) {
                "403 forbidden" === e && i.destroy();
            });
        } ]), this.timeMap = {}, this.customTimePipeline = q([ k(this, 5), function(e) {
            return i.send({
                url: i.config.customTimeUrl + "?payload=" + encodeURIComponent(JSON.stringify({
                    custom: e
                })),
                type: g.CUSTOM,
                log: e
            }, function() {}, function(e) {
                "403 forbidden" === e && i.destroy();
            });
        } ]), this.config = (n = this.config, void 0 === (e = e.hostUrl) && (e = "https://aegis.qq.com"), 
        n.url = n.url || e + "/collect", n.offlineUrl = n.offlineUrl || e + "/offline", 
        n.whiteListUrl = n.whiteListUrl || e + "/collect/whitelist", n.pvUrl = n.pvUrl || e + "/collect/pv", 
        n.eventUrl = n.eventUrl || e + "/collect/events", n.speedUrl = n.speedUrl || e + "/speed", 
        n.customTimeUrl = n.customTimeUrl || e + "/speed/custom", n.performanceUrl = n.performanceUrl || e + "/speed/performance", 
        n.webVitalsUrl = n.webVitalsUrl || e + "/speed/webvitals", n), ce.instances.push(this);
    }
    return K.use(ne), K.use(F), K.use(G), K.use(Q), K.use(M), K.use(W), K;
});